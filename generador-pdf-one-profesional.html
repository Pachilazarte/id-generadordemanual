<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ONE - Generador de Manuales PDF Profesional</title>

  <link rel="icon" type="image/png" href="./img/favicon.png" sizes="32x32">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root {
      --c-black: #000000;
      --c-ink: #1a181d;
      --c-white: #fefeff;
      --c-pink: #e17bd7;
      --c-cyan: #6be1e3;
      --c-gold: #e4c76a;
      --c-slate: #a4a8c0;
      --c-mist: #c6c9d7;
      --font-title: "Exo 2", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-sub: "Futura", "Futura PT", "Avenir", "Trebuchet MS", "Segoe UI", Arial, sans-serif;
      --container: 1200px;
      --radius-xl: 28px;
      --radius-lg: 18px;
      --shadow-soft: 0 18px 60px rgba(0,0,0,.55);
      --glass: rgba(254,254,255,.08);
      --stroke: rgba(198,201,215,.25);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html {
      height: 100%;
      scrollbar-width: thin;
      scrollbar-color: var(--c-pink) var(--c-black);
    }

    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      background-color: var(--c-black);
      color: var(--c-white);
      font-family: var(--font-sub);
      overflow-x: hidden;
      line-height: 1.6;
    }

    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }

    .bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background: 
        radial-gradient(1200px 700px at 70% 25%, rgba(225,123,215,.18), transparent 55%),
        radial-gradient(1100px 700px at 80% 60%, rgba(107,225,227,.14), transparent 55%),
        radial-gradient(900px 600px at 20% 70%, rgba(228,199,106,.10), transparent 60%),
        linear-gradient(180deg, var(--c-black), var(--c-ink));
    }

    .bg::before {
      content: "";
      position: absolute;
      inset: -10%;
      background:
        radial-gradient(circle at 25% 20%, rgba(107,225,227,.12), transparent 40%),
        radial-gradient(circle at 80% 35%, rgba(225,123,215,.12), transparent 38%),
        radial-gradient(circle at 55% 85%, rgba(228,199,106,.10), transparent 45%);
      filter: blur(18px);
      opacity: .95;
    }

    .hex {
      position: absolute;
      inset: -20%;
      opacity: .16;
      filter: drop-shadow(0 0 12px rgba(107,225,227,.15));
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='150'%3E%3Cg fill='none' stroke='%23c6c9d7' stroke-opacity='0.85' stroke-width='1'%3E%3Cpath d='M50 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M120 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M190 20l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M85 55l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M155 55l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M50 90l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M120 90l20-12 20 12v24l-20 12-20-12z'/%3E%3Cpath d='M190 90l20-12 20 12v24l-20 12-20-12z'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 260px 150px;
      transform: rotate(-8deg);
      mix-blend-mode: screen;
    }

    canvas#stars { position: absolute; inset: 0; }

    .wrap {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 100vh;
    }

    header {
      width: 100%;
      padding: 26px 22px 8px;
      position: sticky;
      top: 0;
      z-index: 5;
      background: linear-gradient(180deg, rgba(0,0,0,.35), transparent);
      backdrop-filter: blur(10px);
    }

    header.scrolled {
      background: rgba(0,0,0,.7);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border-bottom: 1px solid rgba(198,201,215,.10);
    }

    .nav {
      max-width: var(--container);
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      user-select: none;
    }

    .brand .mark {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-image: url('./img/one-iconocolor.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      box-shadow: 0 0 0 1px rgba(198,201,215,.18), 0 0 40px rgba(107,225,227,.18);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .brand .mark::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 30%, rgba(254,254,255,.14), transparent 55%);
      pointer-events: none;
    }

    .brand .name {
      font-family: var(--font-title);
      letter-spacing: .04em;
      font-weight: 800;
      font-size: 24px;
      line-height: 1.1;
    }

    .brand .sub {
      display: block;
      font-family: var(--font-sub);
      font-weight: 500;
      font-size: 13px;
      color: rgba(198,201,215,.85);
      letter-spacing: .02em;
      margin-top: 2px;
    }

    main {
      flex: 1;
      width: 100%;
      padding: 60px 30px 100px;
    }

    .container {
      max-width: var(--container);
      margin: 0 auto;
    }

    .hero-section {
      text-align: center;
      margin-bottom: 80px;
    }

    .hero-section h1 {
      font-family: var(--font-title);
      font-size: clamp(48px, 6vw, 72px);
      line-height: 1.1;
      margin: 0 0 30px;
      letter-spacing: -.02em;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }

    .grad-cyan {
      background: linear-gradient(90deg, var(--c-cyan), rgba(107,225,227,.65));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .hero-section p {
      max-width: 800px;
      margin: 0 auto 40px;
      font-size: 20px;
      line-height: 1.8;
      color: rgba(198,201,215,.95);
    }

    .prompt-btn {
      background: linear-gradient(135deg, var(--c-gold), var(--c-pink));
      color: var(--c-white);
      padding: 16px 40px;
      border: none;
      border-radius: 999px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 30px rgba(228,199,106,.4);
      font-family: var(--font-title);
      margin-bottom: 30px;
    }

    .prompt-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 50px rgba(228,199,106,.6);
    }

    .form-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 40px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .input-group {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--stroke);
      border-radius: var(--radius-lg);
      padding: 40px;
      box-shadow: var(--shadow-soft);
      transition: all 0.3s;
    }

    .input-group:hover {
      border-color: rgba(107,225,227,.35);
      box-shadow: 0 25px 70px rgba(0,0,0,.65);
    }

    .input-group h3 {
      font-family: var(--font-title);
      font-size: 1.8em;
      font-weight: 800;
      margin-bottom: 25px;
      color: var(--c-white);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .input-group h3::before {
      content: 'â–¸';
      color: var(--c-cyan);
      font-size: 1.3em;
    }

    label {
      display: block;
      margin-bottom: 12px;
      color: var(--c-slate);
      font-weight: 600;
      font-size: 1em;
      font-family: var(--font-title);
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 18px;
      background: rgba(0,0,0,.5);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      color: var(--c-white);
      font-family: var(--font-sub);
      font-size: 16px;
      margin-bottom: 25px;
      transition: all 0.3s;
    }

    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: var(--c-cyan);
      box-shadow: 0 0 30px rgba(107,225,227,.35);
      background: rgba(0,0,0,.7);
    }

    textarea {
      resize: vertical;
      min-height: 250px;
      font-family: 'Courier New', monospace;
      line-height: 1.7;
    }

    textarea#contenido { min-height: 600px; }

    ::placeholder {
      color: var(--c-slate);
      opacity: 0.5;
    }

    .info-box {
      background: rgba(107,225,227,.08);
      border-left: 4px solid var(--c-cyan);
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      color: var(--c-cyan);
    }

    .info-box h4 {
      margin-bottom: 15px;
      font-size: 1.15em;
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: var(--font-title);
    }

    .info-box ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .info-box li {
      padding: 8px 0;
      font-size: 0.95em;
      color: var(--c-mist);
      line-height: 1.6;
    }

    .info-box li::before {
      content: "âœ“ ";
      color: var(--c-gold);
      font-weight: bold;
      margin-right: 10px;
    }

    .generate-section {
      text-align: center;
      margin-top: 60px;
      padding: 40px 0;
    }

    .generate-btn {
      background: linear-gradient(135deg, var(--c-cyan), var(--c-pink));
      color: var(--c-white);
      padding: 28px 80px;
      border: none;
      border-radius: 999px;
      font-size: 1.8em;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 20px 50px rgba(107,225,227,.5);
      font-family: var(--font-title);
      position: relative;
      overflow: hidden;
    }

    .generate-btn:hover {
      transform: translateY(-6px) scale(1.05);
      box-shadow: 0 30px 70px rgba(225,123,215,.7);
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(12px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active { display: flex; }

    .modal-content {
      background: var(--c-ink);
      border: 2px solid var(--stroke);
      border-radius: var(--radius-xl);
      padding: 50px;
      max-width: 800px;
      width: 90%;
      box-shadow: var(--shadow-soft);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--c-mist);
      font-size: 36px;
      cursor: pointer;
      transition: color 0.3s;
    }

    .modal-close:hover { color: var(--c-white); }

    .modal h3 {
      font-size: 2.2em;
      margin-bottom: 25px;
      background: linear-gradient(135deg, var(--c-cyan), var(--c-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-family: var(--font-title);
    }

    .prompt-text {
      background: rgba(0,0,0,.5);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 25px;
      font-family: 'Courier New', monospace;
      color: var(--c-cyan);
      font-size: 1em;
      line-height: 1.9;
      margin-bottom: 25px;
      max-height: 450px;
      overflow-y: auto;
    }

    .copy-btn {
      background: linear-gradient(135deg, var(--c-cyan), var(--c-pink));
      color: var(--c-white);
      padding: 18px 45px;
      border: none;
      border-radius: 999px;
      font-size: 1.2em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 35px rgba(107,225,227,.35);
      font-family: var(--font-title);
      width: 100%;
    }

    .copy-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 50px rgba(107,225,227,.6);
    }

    .copy-btn.copied {
      background: linear-gradient(135deg, var(--c-gold), var(--c-pink));
    }

    .premium-footer {
      width: 100%;
      margin-top: auto;
      flex-shrink: 0;
      border-top: 3px solid #ff69b4;
      background: #000000 !important;
      padding: 22px 0;
      color: #ffffff;
      font-size: 14px;
      z-index: 10;
    }

    .footer-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .footer-left {
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0.9;
    }

    .footer-logo-letra {
      height: 20px;
      width: auto;
    }

    .footer-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .developed-txt {
      font-size: 13px;
      opacity: 0.75;
    }

    .dev-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .dev-link:hover {
      opacity: 0.85;
      transform: translateY(-2px);
    }

    .dev-logo-one { height: 24px; width: auto; }
    .by-txt { margin: 0 8px; font-style: italic; opacity: 0.75; font-size: 14px; }
    .dev-logo-escencial { height: 26px; width: auto; }

    ::-webkit-scrollbar { width: 12px; }
    ::-webkit-scrollbar-track { background: var(--c-black); }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--c-cyan), var(--c-pink));
      border-radius: 99px;
      border: 3px solid var(--c-black);
      background-clip: content-box;
    }

    @media (max-width: 768px) {
      .footer-container { flex-direction: column; gap: 18px; text-align: center; }
      .footer-left, .footer-right { flex-wrap: wrap; justify-content: center; }
      .hero-section h1 { font-size: 2.8em; }
      .input-group { padding: 30px; }
      .generate-btn { padding: 22px 50px; font-size: 1.4em; }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true">
    <canvas id="stars"></canvas>
    <div class="hex"></div>
  </div>

  <div class="wrap">
    <header id="header">
      <div class="nav">
        <div class="brand">
          <div class="mark"></div>
          <div>
            <div class="name">ONE</div>
            <span class="sub">Generador de Manuales PDF</span>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="hero-section">
          <h1>Generador de <span class="grad-cyan">Manuales Profesionales</span></h1>
          <p>Crea documentos PDF de alta calidad con procesamiento inteligente de Markdown y diseÃ±o corporativo ONE</p>
          <button class="prompt-btn" onclick="mostrarPrompt()">ğŸ“‹ Ver Prompt Recomendado</button>
        </div>

        <div class="form-wrapper">
          <div class="input-group">
            <h3>Portada del Manual</h3>
            <label for="titulo">Nombre del Manual *</label>
            <input type="text" id="titulo" placeholder="Ej: Manual de Operaciones LogÃ­sticas" required>
            <label for="proyecto">Nombre del Proyecto (Opcional)</label>
            <input type="text" id="proyecto" placeholder="Ej: Sistema de GestiÃ³n 2026">
            <div class="info-box">
              <h4>â„¹ï¸ InformaciÃ³n</h4>
              <ul>
                <li>Empresa: ONE (fijo)</li>
                <li>Marca de agua en todas las pÃ¡ginas</li>
                <li>NumeraciÃ³n automÃ¡tica</li>
              </ul>
            </div>
          </div>

          <div class="input-group">
            <h3>Estructura del Ãndice</h3>
            <label for="indice">Ãndice JerÃ¡rquico (sin sÃ­mbolos) *</label>
            <textarea id="indice" placeholder="1. IntroducciÃ³n&#10;1.1. Antecedentes&#10;2. Desarrollo&#10;2.1. ImplementaciÃ³n" required></textarea>
            <div class="info-box">
              <h4>ğŸ” DetecciÃ³n AutomÃ¡tica</h4>
              <ul>
                <li>NÃºmeros jerÃ¡rquicos: 1., 1.1., 2.1.3.</li>
                <li>VinculaciÃ³n con contenido</li>
              </ul>
            </div>
          </div>

          <div class="input-group">
            <h3>Contenido del Manual</h3>
            <label for="contenido">Texto con Formato Markdown (con sÃ­mbolos ##, **, *) *</label>
            <textarea id="contenido" placeholder="## 1. IntroducciÃ³n&#10;&#10;Bienvenido al **Sistema ONE**...&#10;&#10;### 1.1. Antecedentes&#10;&#10;* Primera viÃ±eta&#10;* Segunda viÃ±eta&#10;&#10;---" required></textarea>
            <div class="info-box">
              <h4>ğŸ’¡ Formatos Soportados</h4>
              <ul>
                <li>## CapÃ­tulo | ### SecciÃ³n</li>
                <li>**negrita** | *cursiva*</li>
                <li>* viÃ±etas | 1. numeradas</li>
                <li>--- separador</li>
              </ul>
            </div>
          </div>

          <div class="generate-section">
            <button class="generate-btn" onclick="generarPDF()">âœ¨ Generar PDF</button>
          </div>
        </div>
      </div>
    </main>

    <footer class="premium-footer">
      <div class="footer-container">
        <div class="footer-left">
          <img src="./img/one-logoletra.png" alt="ONE" class="footer-logo-letra">
          <span> | Todos los derechos reservados. Â© 2026</span>
        </div>
        <div class="footer-right">
          <span class="developed-txt">Desarrollado por</span>
          <a href="https://escencialconsultora.com.ar/" target="_blank" class="dev-link">
            <img src="./img/one-logocolor.png" alt="ONE" class="dev-logo-one">
            <span class="by-txt">by</span>
            <img src="./img/escencial-logoblanco.png" alt="Escencial" class="dev-logo-escencial">
          </a>
        </div>
      </div>
    </footer>
  </div>

<div class="modal" id="promptModal">
    <div class="modal-content">
      <button class="modal-close" onclick="cerrarPrompt()">&times;</button>
      <h3>ğŸ“‹ Prompt Recomendado</h3>
      <div class="prompt-text" id="promptText" style="white-space: pre-wrap;">Rol: ActÃºa como un Expert Technical Writer especializado en DocumentaciÃ³n Corporativa y Procesos.

Objetivo: Redactar un manual de usuario exhaustivo (de 2,500 a 4,000 palabras) para un sistema basado en los archivos adjuntos.

âš ï¸ INSTRUCCIONES CRÃTICAS DE FORMATO Y SALIDA:
1. SALIDA EN UN ÃšNICO BLOQUE DE CÃ“DIGO: Para asegurar la integridad del texto crudo, toda tu respuesta (desde el tÃ­tulo, pasando por el Ã­ndice, hasta el punto final del manual) debe estar encerrada dentro de un Ãºnico bloque de cÃ³digo Markdown. No escribas nada fuera de ese bloque.
2. CERO EMOJIS: EstÃ¡ terminantemente prohibido usar emojis o iconos grÃ¡ficos en cualquier parte del texto. El estilo debe ser sobrio, limpio y profesional.
3. TABLAS EN FORMATO CSV: Si necesitas representar datos estructurados (tablas), NO uses formato visual ni de markdown tradicional. Escribe los datos estrictamente en formato CSV (Valores Separados por Comas).
   * Ejemplo obligatorio:
     Campo,DescripciÃ³n,AcciÃ³n
     Nombre,Ingresa tu nombre,Escribir texto
4. MARKDOWN JERÃRQUICO: Dentro del bloque de cÃ³digo, usa # para el TÃ­tulo Principal, ## para CapÃ­tulos y ### para SubtÃ­tulos.

REGLAS DE CONTENIDO:
* Lenguaje de Usuario: Prohibido mencionar variables, scripts .gs, html o cÃ³digo interno. Traduce todo a: "Pantallas", "Botones", "Formularios", "Bases de Datos", "Carpetas".
* Correspondencia Exacta: Los tÃ­tulos desarrollados en el cuerpo del texto deben ser idÃ©nticos a los definidos en el Ãndice (copia textual).
* Profundidad: No resumas. ExtiÃ©ndete en cada explicaciÃ³n paso a paso.

ESTRUCTURA A SEGUIR (Todo dentro del bloque de cÃ³digo):

PASO 1: Ãndice Maestro
Crea un Ã­ndice numerado (1, 2, 3...) con al menos 8 CapÃ­tulos Principales que cubran todo el flujo.

PASO 2: Desarrollo del Manual
Desarrolla el contenido respetando estrictamente el Ã­ndice. GuÃ­a de contenido:
1. IntroducciÃ³n y Propuesta de Valor: QuÃ© hace el sistema y beneficios.
2. Acceso y Requisitos: CÃ³mo entrar a la URL y explicaciÃ³n sencilla de los permisos de Google.
3. Recorrido Visual: DescripciÃ³n de la interfaz.
4. OperaciÃ³n Paso a Paso: GuÃ­a de llenado de formularios y uso de botones.
5. LÃ³gica del Sistema: Explica cÃ³mo el sistema lee la "Base de Datos" y usa archivos de la "Carpeta Main" en la nube.
6. GestiÃ³n de Resultados: DÃ³nde se guardan los archivos finales.
7. GuÃ­a de SoluciÃ³n de Dudas: (AquÃ­ es obligatorio usar formato CSV para listar Problema, Causa, SoluciÃ³n).
8. Consejos de Eficiencia: Buenas prÃ¡cticas.

Â¡Comienza! Genera el Ãndice y el Manual completo dentro del bloque de cÃ³digo ahora.</div>
      <button class="copy-btn" id="copyBtn" onclick="copiarPrompt()">ğŸ“‹ Copiar Prompt</button>
    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 1. FUNCIONES INTERFAZ WEB (UI)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function mostrarPrompt() { document.getElementById('promptModal').classList.add('active'); }
    function cerrarPrompt() { document.getElementById('promptModal').classList.remove('active'); }
    
    function copiarPrompt() {
      const texto = document.getElementById('promptText').innerText;
      navigator.clipboard.writeText(texto).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.innerText = 'âœ… Â¡Copiado!';
        btn.classList.add('copied');
        setTimeout(() => { btn.innerText = 'ğŸ“‹ Copiar Prompt'; btn.classList.remove('copied'); }, 2500);
      });
    }

    // AnimaciÃ³n de estrellas
    const canvas = document.getElementById('stars');
    const ctx = canvas.getContext('2d', { alpha: true });
    let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio || 1, 2);
    let stars = [];

    function resize() {
      W = window.innerWidth; H = window.innerHeight;
      canvas.width = Math.floor(W * DPR); canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      stars = Array.from({length: 150}, () => ({
        x: Math.random() * W, y: Math.random() * H,
        r: Math.random() * 1.35 + 0.25, a: Math.random() * 0.6 + 0.15,
        vx: (Math.random() - 0.5) * 0.06, vy: (Math.random() - 0.5) * 0.06,
        tw: Math.random() * 0.012 + 0.003
      }));
    }
    function draw() {
      ctx.clearRect(0, 0, W, H);
      const g = ctx.createRadialGradient(W*0.75, H*0.35, 0, W*0.75, H*0.35, Math.max(W,H)*0.8);
      g.addColorStop(0, 'rgba(225,123,215,0.10)'); g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g; ctx.fillRect(0, 0, W, H);
      for(const s of stars) {
        s.x += s.vx; s.y += s.vy;
        if(s.x < -10) s.x = W + 10; if(s.x > W + 10) s.x = -10;
        if(s.y < -10) s.y = H + 10; if(s.y > H + 10) s.y = -10;
        s.a += Math.sin((s.x + s.y) * 0.002) * s.tw;
        const alpha = Math.max(0.08, Math.min(0.85, s.a));
        ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fillStyle = `rgba(254,254,255,${alpha})`; ctx.fill();
      }
      requestAnimationFrame(draw);
    }
    resize(); draw(); window.addEventListener('resize', resize);
    document.getElementById('promptModal').addEventListener('click', function(e) { if (e.target === this) cerrarPrompt(); });


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 2. CONFIGURACIÃ“N PDF (DISEÃ‘O ONE)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const CFG = {
      W: 210, H: 297, ML: 25, MR: 25, CW: 160, YMAX: 270,
      PINK_BRAND: [218, 85, 194],
      PINK_LIGHT: [235, 150, 220],
      DARK_BG: [20, 10, 30],
      TEXT_DARK: [35, 31, 32],
      TEXT_WHITE: [255, 255, 255],
      CYAN_ONE: [120, 225, 240]
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 3. FUNCIONES DE PROCESAMIENTO
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function procesarMarkdownCompleto(texto) {
      const tablasCSV = [];
      const lineas = texto.split('\n');
      let nuevoTexto = [];
      let i = 0;
      
      while (i < lineas.length) {
        const linea = lineas[i];
        if (linea.includes(',') && !linea.startsWith('#') && !linea.startsWith('*') && !linea.match(/^\d+\./)) {
          const headers = linea.split(',').map(h => h.trim());
          const rows = [];
          i++;
          while (i < lineas.length && lineas[i].includes(',') && !lineas[i].startsWith('#')) {
            rows.push(lineas[i].split(',').map(c => c.trim()));
            i++;
          }
          if (rows.length > 0) {
            tablasCSV.push({ headers, rows });
            nuevoTexto.push(`[TABLA_${tablasCSV.length - 1}]`);
            continue;
          }
        }
        nuevoTexto.push(linea);
        i++;
      }
      return { procesado: nuevoTexto.join('\n'), tablasCSV };
    }

    function analizarIndice(textoIndice) {
      const indices = [];
      const lineas = textoIndice.split('\n').filter(l => l.trim());
      lineas.forEach(linea => {
        const match = linea.match(/^(\d+(?:\.\d+)*)\.\s*(.+)$/);
        if (match) indices.push({ numero: match[1], titulo: match[2].trim(), nivel: match[1].split('.').length });
      });
      return indices;
    }

    function detectarCapitulos(contenido, indices) {
      const caps = [];
      const regex = /^(#{2,3})\s+(\d+(?:\.\d+)*)\.\s*(.+)$/gm;
      let match;
      while ((match = regex.exec(contenido)) !== null) {
        const existe = indices.find(idx => idx.numero === match[2]);
        if (existe) {
          caps.push({
            numero: match[2], titulo: match[3].trim(),
            nivel: match[1].length - 1, textoCompleto: match[0],
            posicion: match.index
          });
        }
      }
      return caps.sort((a, b) => a.posicion - b.posicion);
    }

    function limpiarMarkdown(texto) {
      return texto.replace(/^#{1,6}\s+/gm, '')
                  .replace(/\*\*\*(.+?)\*\*\*/g, '$1')
                  .replace(/\*\*(.+?)\*\*/g, '$1')
                  .replace(/\*([^*]+?)\*/g, '$1')
                  .replace(/`(.+?)`/g, '$1');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 4. FUNCIONES DE DIBUJO PDF
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function agregarMarcaDeAgua(doc, numeroPagina) {
      try {
        doc.saveGraphicsState(); 
        doc.setGState(new doc.GState({ opacity: 0.08 })); 
        const size = 120; 
        const x = (CFG.W - size) / 2; 
        const y = (CFG.H - size) / 2; 
        doc.addImage('./img/one-iconocolor.png', 'PNG', x, y, size, size);
        doc.restoreGraphicsState(); 
      } catch (e) {}

      const bottomY = 285;
      doc.setDrawColor(...CFG.PINK_BRAND); 
      doc.setLineWidth(1);
      doc.line(CFG.ML, bottomY - 5, CFG.W - CFG.MR, bottomY - 5);
      
      doc.setFontSize(9); 
      doc.setTextColor(...CFG.TEXT_DARK); 
      doc.setFont('helvetica', 'normal');
      
      doc.text('ONE Manual Profesional', CFG.ML, bottomY);
      doc.text(`PÃ¡gina ${numeroPagina}`, CFG.W - CFG.MR, bottomY, { align: 'right' });
    }

    function crearPortada(doc, titulo, proyecto) {
      // FONDO
      try {
        doc.addImage('./img/pdf-fondoportada.jpg', 'JPEG', 0, 0, CFG.W, CFG.H);
      } catch (error) {
        doc.setFillColor(...CFG.DARK_BG);
        doc.rect(0, 0, CFG.W, CFG.H, 'F');
      }

      // BANDERÃN SUPERIOR IZQUIERDO
      doc.setFillColor(0, 0, 0); 
      doc.setGState(new doc.GState({ opacity: 0.4 })); 
      doc.lines([[35, 0], [0, 45], [-17.5, -15], [-17.5, 15], [0, -45]], 27, 2, [1, 1], 'F');
      doc.setGState(new doc.GState({ opacity: 1 }));
      
      doc.setFillColor(...CFG.PINK_BRAND); 
      doc.lines([[35, 0], [0, 45], [-17.5, -15], [-17.5, 15], [0, -45]], 25, 0, [1, 1], 'F');
      
      try {
        doc.addImage('./img/one-iconocolor.png', 'PNG', 33, 8, 18, 18);
      } catch (e) {}

      // TEXTO "ONE" SUPERIOR DERECHA
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(40);
      doc.setTextColor(0, 0, 0);
      doc.setGState(new doc.GState({ opacity: 0.4 }));
      doc.text("ONE", CFG.W - 23, 32, { align: 'right' });
      doc.setGState(new doc.GState({ opacity: 1 }));
      doc.setTextColor(...CFG.CYAN_ONE);
      doc.text("ONE", CFG.W - 25, 30, { align: 'right' });

      // FRANJA TÃTULO - MEJORADA Y AJUSTADA
      const yManual = 145;
      doc.setFontSize(32); // TÃ­tulo MÃS GRANDE
      doc.setFont('helvetica', 'bold');
      
      const tituloLimpio = limpiarMarkdown(titulo);
      const maxWidth = 150;
      const lineasTitulo = doc.splitTextToSize(tituloLimpio, maxWidth);
      
      const lineHeight = 14;
      const alturaTotalTexto = lineasTitulo.length * lineHeight;
      const paddingVertical = 18;
      const alturaFranja = alturaTotalTexto + (paddingVertical * 2);
      
      let anchoMaximo = 0;
      lineasTitulo.forEach(linea => {
        const ancho = doc.getTextWidth(linea);
        if (ancho > anchoMaximo) anchoMaximo = ancho;
      });
      
      const padding = 35;
      const anchoTotal = anchoMaximo + padding + 20;
      
      // Sombra
      doc.setFillColor(0, 0, 0);
      doc.setGState(new doc.GState({ opacity: 0.4 }));
      doc.roundedRect(2, yManual + 2, anchoTotal, alturaFranja, 0, 0, 'F');
      doc.circle(anchoTotal + 2, yManual + (alturaFranja / 2) + 2, alturaFranja / 2, 'F');
      doc.setGState(new doc.GState({ opacity: 1 }));

      // Franja principal
      doc.setFillColor(...CFG.PINK_BRAND);
      doc.roundedRect(0, yManual, anchoTotal, alturaFranja, 0, 0, 'F'); 
      doc.circle(anchoTotal, yManual + (alturaFranja / 2), alturaFranja / 2, 'F'); 

      // Efecto glossy
      doc.setFillColor(255, 255, 255);
      doc.setGState(new doc.GState({ opacity: 0.15 }));
      doc.rect(0, yManual, anchoTotal, alturaFranja / 2, 'F');
      doc.setGState(new doc.GState({ opacity: 1 }));

      // Texto del tÃ­tulo
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(32);
      let yTexto = yManual + paddingVertical + 9;
      lineasTitulo.forEach(linea => {
        doc.text(linea, 25, yTexto);
        yTexto += lineHeight;
      });

      // PROYECTO - MÃS GRANDE Y VISIBLE
      if (proyecto) {
        let yProyecto = yManual + alturaFranja + 30;
        
        doc.setFontSize(24); // MÃS GRANDE
        doc.setFont('helvetica', 'normal');
        
        const proyectoLimpio = limpiarMarkdown(proyecto);
        
        // Sombra del proyecto
        doc.setTextColor(0, 0, 0);
        doc.setGState(new doc.GState({ opacity: 0.6 }));
        doc.text(proyectoLimpio, 27, yProyecto + 1);
        doc.setGState(new doc.GState({ opacity: 1 }));
        
        // Texto proyecto
        doc.setTextColor(255, 255, 255);
        doc.text(proyectoLimpio, 25, yProyecto);
      }

      // LOGO INFERIOR DERECHA
      try {
        doc.addImage('./img/one-logoletra.png', 'PNG', CFG.W - 55, CFG.H - 30, 30, 15);
      } catch (e) {
        doc.setFontSize(16);
        doc.setTextColor(255, 255, 255);
        doc.text("ONE", CFG.W - 25, CFG.H - 20, { align: 'right' });
      }
    }

    function crearIndice(doc, indices, pagina) {
      // Solo crear si hay contenido
      if (indices.length === 0) return;
      
      agregarMarcaDeAgua(doc, pagina);
      
      doc.setFontSize(22);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(50, 0, 50); 
      doc.text('ÃNDICE DE CONTENIDOS', CFG.ML, 40);
      
      doc.setDrawColor(...CFG.PINK_BRAND);
      doc.setLineWidth(1.5);
      doc.line(CFG.ML, 45, CFG.W - CFG.MR, 45);
      
      let y = 60;
      indices.forEach(idx => {
        if (y > CFG.YMAX - 20) { doc.addPage(); pagina++; agregarMarcaDeAgua(doc, pagina); y = 40; }
        
        const indent = (idx.nivel - 1) * 10;
        const isMain = idx.nivel === 1;
        
        doc.setFontSize(isMain ? 12 : 11);
        doc.setFont('helvetica', isMain ? 'bold' : 'normal');
        doc.setTextColor(...CFG.TEXT_DARK);
        
        doc.text(idx.numero + '.', CFG.ML + indent, y);
        const titulo = limpiarMarkdown(idx.titulo);
        const split = doc.splitTextToSize(titulo, 130 - indent);
        doc.text(split[0], CFG.ML + 15 + indent, y);
        
        y += isMain ? 10 : 7;
      });
    }

    function procesarTextoConFormato(doc, texto, x, y, maxWidth) {
      const partes = [];
      let lastIndex = 0;
      
      const regexBold = /\*\*(.+?)\*\*/g;
      let match;
      
      while ((match = regexBold.exec(texto)) !== null) {
        if (match.index > lastIndex) {
          partes.push({ texto: texto.substring(lastIndex, match.index), bold: false });
        }
        partes.push({ texto: match[1], bold: true });
        lastIndex = match.index + match[0].length;
      }
      
      if (lastIndex < texto.length) {
        partes.push({ texto: texto.substring(lastIndex), bold: false });
      }
      
      if (partes.length === 0) {
        partes.push({ texto: texto, bold: false });
      }
      
      let currentX = x;
      const currentFont = doc.getFont();
      
      partes.forEach(parte => {
        doc.setFont('helvetica', parte.bold ? 'bold' : 'normal');
        
        const palabras = parte.texto.split(' ');
        palabras.forEach((palabra, idx) => {
          const espaciado = idx > 0 ? ' ' : '';
          const textoCompleto = espaciado + palabra;
          const anchoTexto = doc.getTextWidth(textoCompleto);
          
          if (currentX + anchoTexto > x + maxWidth) {
            return;
          }
          
          doc.text(textoCompleto, currentX, y);
          currentX += anchoTexto;
        });
      });
      
      doc.setFont(currentFont.fontName, currentFont.fontStyle);
      return y;
    }

    function crearContenido(doc, contenido, caps, tablasCSV, pagina) {
      let y = 40;
      agregarMarcaDeAgua(doc, pagina);
      let procesado = contenido;
      
      caps.forEach(cap => { procesado = procesado.replace(cap.textoCompleto, `[CAPITULO_${cap.numero}]`); });
      
      const bloques = procesado.split('\n\n').filter(b => b.trim());
      
      bloques.forEach(bloque => {
        if (!bloque.trim()) return;

        // CAPÃTULOS
        const matchCap = bloque.match(/\[CAPITULO_([\d.]+)\]/);
        if (matchCap) {
          const cap = caps.find(c => c.numero === matchCap[1]);
          if (cap) {
            if (cap.nivel === 1) { 
              doc.addPage(); 
              pagina++; 
              agregarMarcaDeAgua(doc, pagina); 
              y = 40; 
            } else if (y > 230) {
              doc.addPage(); 
              pagina++; 
              agregarMarcaDeAgua(doc, pagina); 
              y = 40;
            }
            
            y += 10;
            const titulo = limpiarMarkdown(cap.titulo.toUpperCase());
            doc.setFont('helvetica', 'bold');
            
            if (cap.nivel === 1) {
                doc.setFontSize(16); 
                doc.setTextColor(50, 0, 50);
                doc.text(`${cap.numero}. ${titulo}`, CFG.ML, y);
                y += 2;
                doc.setDrawColor(...CFG.PINK_BRAND); 
                doc.setLineWidth(1); 
                doc.line(CFG.ML, y, CFG.W - CFG.MR, y);
                y += 15;
            } else {
                doc.setFontSize(13); 
                doc.setTextColor(...CFG.PINK_BRAND);
                doc.text(`${cap.numero} ${cap.titulo}`, CFG.ML, y);
                y += 10;
            }
            return;
          }
        }

        // TABLAS
        const matchTabla = bloque.match(/\[TABLA_(\d+)\]/);
        if (matchTabla) {
          const tabla = tablasCSV[parseInt(matchTabla[1])];
          if (tabla) {
             if (y > 200) {
               doc.addPage();
               pagina++;
               agregarMarcaDeAgua(doc, pagina);
               y = 40;
             }
             doc.autoTable({
               startY: y, 
               head: [tabla.headers], 
               body: tabla.rows,
               theme: 'striped',
               headStyles: { fillColor: CFG.PINK_BRAND, textColor: [255,255,255], fontStyle: 'bold' },
               styles: { fontSize: 10, cellPadding: 3, textColor: CFG.TEXT_DARK },
               margin: { left: CFG.ML, right: CFG.MR }
             });
             y = doc.lastAutoTable.finalY + 10;
             return;
          }
        }

        // SEPARADORES
        if (bloque.trim() === '---') {
          if (y > CFG.YMAX - 10) {
            doc.addPage();
            pagina++;
            agregarMarcaDeAgua(doc, pagina);
            y = 40;
          }
          y += 5; 
          doc.setDrawColor(...CFG.PINK_LIGHT); 
          doc.setLineWidth(0.5); 
          doc.line(CFG.ML, y, CFG.W - CFG.MR, y); 
          y += 10;
          return;
        }

        // LISTAS Y TEXTO
        if (y > CFG.YMAX - 15) { 
          doc.addPage(); 
          pagina++; 
          agregarMarcaDeAgua(doc, pagina); 
          y = 40; 
        }
        
        doc.setTextColor(...CFG.TEXT_DARK); 
        doc.setFontSize(10); 
        doc.setFont('helvetica', 'normal');

        const esLista = /^[\*\-]\s+/.test(bloque) || /^\d+\.\s+/.test(bloque);
        if (esLista) {
            const items = bloque.split('\n');
            items.forEach(item => {
               if (!item.trim()) return;
               
               if (y > CFG.YMAX - 10) {
                 doc.addPage();
                 pagina++;
                 agregarMarcaDeAgua(doc, pagina);
                 y = 40;
               }
               
               let txt = item, bullet = '', off = 0;
               
               if (/^[\*\-]\s+/.test(item)) {
                   bullet = 'â€¢'; 
                   txt = item.replace(/^[\*\-]\s+/, ''); 
                   off = 8;
                   doc.setTextColor(...CFG.PINK_BRAND); 
                   doc.setFontSize(12);
                   doc.text(bullet, CFG.ML, y);
                   doc.setTextColor(...CFG.TEXT_DARK);
                   doc.setFontSize(10);
               } else if (/^\d+\.\s+/.test(item)) {
                   const m = item.match(/^(\d+\.)\s+/); 
                   bullet = m[1]; 
                   txt = item.replace(/^\d+\.\s+/, ''); 
                   off = 12;
                   doc.setFont('helvetica', 'bold'); 
                   doc.text(bullet, CFG.ML, y); 
                   doc.setFont('helvetica', 'normal');
               }
               
               procesarTextoConFormato(doc, txt, CFG.ML + off, y, CFG.CW - off);
               y += 6;
            });
            y += 4;
            return;
        }

        // TEXTO NORMAL con formato
        const lineas = doc.splitTextToSize(bloque, CFG.CW);
        lineas.forEach(linea => {
           if (y > CFG.YMAX - 10) {
             doc.addPage();
             pagina++;
             agregarMarcaDeAgua(doc, pagina);
             y = 40;
           }
           procesarTextoConFormato(doc, linea, CFG.ML, y, CFG.CW);
           y += 5;
        });
        y += 4;
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 5. FUNCIÃ“N PRINCIPAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generarPDF() {
      const titulo = document.getElementById('titulo').value.trim();
      const proyecto = document.getElementById('proyecto').value.trim();
      const indiceTexto = document.getElementById('indice').value.trim();
      const contenidoRaw = document.getElementById('contenido').value.trim();
      
      if (!titulo || !indiceTexto || !contenidoRaw || !proyecto) { 
        alert('âŒ Faltan datos obligatorios. Por favor completa TÃ­tulo, Proyecto, Ãndice y Contenido.'); 
        return; 
      }

      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
        let pag = 1;

        const { procesado, tablasCSV } = procesarMarkdownCompleto(contenidoRaw);
        const indices = analizarIndice(indiceTexto);
        const caps = detectarCapitulos(procesado, indices);

        // PORTADA
        crearPortada(doc, titulo, proyecto); 
        pag++;
        
        // ÃNDICE (solo si tiene contenido)
        if (indices.length > 0) {
          doc.addPage(); 
          crearIndice(doc, indices, pag); 
          pag++;
        }
        
        // CONTENIDO (solo si tiene capÃ­tulos)
        if (caps.length > 0) {
          doc.addPage(); 
          crearContenido(doc, procesado, caps, tablasCSV, pag);
        }

        doc.save(titulo.toLowerCase().replace(/\s+/g, '_') + '_ONE.pdf');
        alert('âœ… PDF generado correctamente!');
        
      } catch (e) {
        console.error(e);
        alert('âŒ Error: ' + e.message);
      }
    }
  </script>
</body>
</html>